# OneDev

DevOps å¹³å°

![OneDev](https://file.lifebus.top/imgs/onedev_cover.png)

![](https://img.shields.io/badge/%E6%96%B0%E7%96%86%E8%90%8C%E6%A3%AE%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E5%B7%A5%E4%BD%9C%E5%AE%A4-%E6%8F%90%E4%BE%9B%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81-blue)

## ç®€ä»‹

OneDev å¯ä»¥åœ¨ 2 æ ¸ 2GB ç›’å­ä¸Šæ„‰å¿«åœ°è¿è¡Œã€‚

OneDev æ˜¯è¿„ä»Šä¸ºæ­¢æˆ‘åœ¨è½¯ä»¶å·¥ç¨‹å¸ˆèŒä¸šç”Ÿæ¶¯ä¸­ä½¿ç”¨è¿‡çš„æœ€å¥½çš„å·¥å…·ã€‚
å®ƒä½¿æˆ‘å’Œæˆ‘çš„å›¢é˜Ÿèƒ½å¤Ÿè½»æ¾è·Ÿè¸ªä»»åŠ¡å’Œä»£ç ï¼Œä¸ºæˆ‘ä»¬çš„ CI/CD åˆ›å»ºæ·±å…¥çš„å¯é‡ç”¨ç®¡é“ï¼Œå®æ–½ï¼ˆå¯é€‰ï¼‰åŸºäºè§’è‰²çš„åˆ†æ”¯ä¿æŠ¤ï¼Œä¸ºæ‹‰å–è¯·æ±‚æä¾›é«˜åº¦è¯¦ç»†çš„ä»£ç å®¡æŸ¥ã€‚

### åŠŸèƒ½ç‰¹æ€§

ğŸ” å¼€ç®±å³ç”¨çš„ä»£ç æœç´¢å’Œå¯¼èˆª

ä»»ä½•æäº¤ä¸­çš„è¯­è¨€æ„ŸçŸ¥ç¬¦å·æœç´¢å’Œå¯¼èˆªã€‚å•å‡»ç¬¦å·å¯æ˜¾ç¤ºå½“å‰æ–‡ä»¶ä¸­å‡ºç°çš„æƒ…å†µã€‚ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå¿«é€Ÿä»£ç æœç´¢ã€‚

ğŸ‘®â€ çµæ´»çš„å®‰å…¨æ€§å’Œåˆè§„æ€§æ‰«æ

æ‰«æä»£ç ä¾èµ–é¡¹ã€æ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–å®¹å™¨æ˜ åƒï¼Œä»¥æŸ¥æ‰¾å®‰å…¨æ¼æ´ã€è®¸å¯è¯è¿è§„æˆ–ç§˜å¯†æ³„éœ²ã€‚

ğŸš¦ ç”¨è¦†ç›–ç‡å’Œé—®é¢˜æ³¨é‡Šä»£ç 

ä»£ç å°†æ ‡æ³¨è¦†ç›–ç‡ä¿¡æ¯ä»¥åŠ CI/CD ç®¡é“ä¸­å‘ç°çš„é—®é¢˜ï¼Œä»¥æ–¹ä¾¿ä»£ç å®¡æŸ¥ã€‚

ğŸ’¬ éšæ—¶éšåœ°ä»£ç è®¨è®º

é€‰æ‹©ä»»ä½•ä»£ç æˆ–å·®å¼‚ä»¥å¼€å§‹è®¨è®ºã€‚å»ºè®®å¹¶åº”ç”¨æ›´æ”¹ã€‚è®¨è®ºé›†ä¸­åœ¨ä»£ç ä¸Šï¼Œä»¥å¸®åŠ©ç†è§£ä»£ç ã€‚

ğŸ”’ å¤šåŠŸèƒ½çš„ä»£ç ä¿æŠ¤è§„åˆ™

è®¾ç½®è§„åˆ™ï¼Œå½“æŸäº›ç”¨æˆ·è§¦æ‘¸æŸäº›åˆ†æ”¯ä¸­çš„æŸäº›æ–‡ä»¶æ—¶ï¼Œè¦æ±‚è¿›è¡Œå®¡æŸ¥æˆ– CI/CD éªŒè¯ã€‚

ğŸ“‹ è‡ªåŠ¨åŒ–çœ‹æ¿ä»¥ä¿æŒå›¢é˜Ÿäº•äº•æœ‰æ¡

åœ¨çœ‹æ¿ä¸­æ‰‹åŠ¨ç§»åŠ¨ä»»åŠ¡ï¼Œæˆ–å®šä¹‰è§„åˆ™ä»¥åœ¨æäº¤/æµ‹è¯•/å‘å¸ƒ/éƒ¨ç½²ç›¸å…³å·¥ä½œæ—¶è‡ªåŠ¨ç§»åŠ¨ä»»åŠ¡ã€‚

ğŸ›  å¯å®šåˆ¶ä¸”çµæ´»çš„é—®é¢˜å·¥ä½œæµç¨‹

è‡ªå®šä¹‰é—®é¢˜çŠ¶æ€å’Œå­—æ®µã€‚æ‰‹åŠ¨æˆ–è‡ªåŠ¨çŠ¶æ€è½¬æ¢è§„åˆ™ã€‚å‘å¸ƒåŒæ­¥æ“ä½œå’ŒçŠ¶æ€çš„é“¾æ¥ã€‚å…¬å…±é¡¹ç›®ä¸­çš„æœºå¯†é—®é¢˜ã€‚

ğŸ“¨ æœåŠ¡å°å°†ç”µå­é‚®ä»¶ä¸é—®é¢˜é“¾æ¥èµ·æ¥

ä½¿ç”¨é—®é¢˜ä½œä¸ºç¥¨è¯ç³»ç»Ÿé€šè¿‡ç”µå­é‚®ä»¶ä¸ºå®¢æˆ·æä¾›æ”¯æŒï¼Œæ— éœ€ä»–ä»¬æ³¨å†Œå¸æˆ·ã€‚ä¸ºä¸åŒçš„é¡¹ç›®æˆ–å®¢æˆ·åˆ†é…ä¸åŒçš„æ”¯æŒè”ç³»äººã€‚

â° æ—¶é—´è·Ÿè¸ªå’ŒæŠ¥å‘Š

è·Ÿè¸ªä»»åŠ¡ä¸Šçš„ä¼°è®¡/èŠ±è´¹æ—¶é—´ã€‚è‡ªåŠ¨èšåˆå­ä»»åŠ¡çš„æ—¶é—´ã€‚ç”Ÿæˆå·¥ä½œç»Ÿè®¡å’Œè®¡è´¹çš„æ—¶é—´è¡¨ã€‚

ğŸ’¡ CI/CD ä½œä¸ºä»£ç ï¼Œæ— éœ€ç¼–å†™ä»£ç 

ç”¨äºåˆ›å»º CI/CD ä½œä¸šçš„ç›´è§‚ GUIã€‚å…¸å‹æ¡†æ¶çš„æ¨¡æ¿ã€‚é”®å…¥å‚æ•°ã€‚çŸ©é˜µä½œä¸šã€‚ CI/CD é€»è¾‘é‡ç”¨ã€‚ç¼“å­˜ç®¡ç†ã€‚

ğŸš€ ä»ç®€å•åˆ°è§„æ¨¡åŒ–çš„å¤šåŠŸèƒ½ CI/CD æ‰§è¡Œå™¨

åœ¨å®¹å™¨ä¸­æˆ–è£¸æœºä¸Šå¼€ç®±å³ç”¨åœ°è¿è¡Œ CI/CDã€‚ä¸ Kubernetes æˆ–ä»£ç†åŒæ—¶è¿è¡Œå¤§é‡ä½œä¸šã€‚

ğŸ›  è°ƒè¯• CI/CD ä½œä¸šçš„å·¥å…·

æš‚åœä½œä¸šæ‰§è¡Œçš„å‘½ä»¤ã€‚ç”¨äºæ£€æŸ¥ä½œä¸šæ‰§è¡Œç¯å¢ƒçš„Webç»ˆç«¯ã€‚é’ˆå¯¹æœªæäº¤çš„æ›´æ”¹åœ¨æœ¬åœ°è¿è¡Œä½œä¸šã€‚

ğŸ“¦ å†…ç½®åŒ…æ³¨å†Œè¡¨

å†…ç½®æ³¨å†Œè¡¨æ¥ç®¡ç†äºŒè¿›åˆ¶åŒ…ã€‚å°†åŒ…ä¸ CI/CD ä½œä¸šé“¾æ¥ã€‚

ğŸ§© æ·±åº¦èåˆã€ä¿¡æ¯äº¤å‰å¼•ç”¨

é€šè¿‡æäº¤ã€CI/CD æˆ–æ‹‰å–è¯·æ±‚ä¼ è¾“é—®é¢˜çŠ¶æ€ã€‚æ˜¾ç¤ºé—®é¢˜çš„ä¿®å¤ç‰ˆæœ¬ã€‚æŸ¥è¯¢æ„å»º/åŒ…ç‰ˆæœ¬ä¹‹é—´çš„å·²ä¿®å¤é—®é¢˜æˆ–ä»£ç æ›´æ”¹ã€‚

ğŸŒ² é¡¹ç›®æ ‘ï¼Œæ–¹ä¾¿ç»´æŠ¤

ä½¿ç”¨æ ‘å½¢ç»“æ„æ¸…æ™°æœ‰æ•ˆåœ°ç»„ç»‡é¡¹ç›®ã€‚åœ¨çˆ¶é¡¹ç›®ä¸­å®šä¹‰é€šç”¨è®¾ç½®å¹¶åœ¨å­é¡¹ç›®ä¸­ç»§æ‰¿ã€‚

ğŸ’ æ™ºèƒ½æŸ¥è¯¢ï¼Œå¯ä¿å­˜ã€è®¢é˜…

å¼ºå¤§è€Œç›´è§‚çš„æŸ¥è¯¢åŠŸèƒ½ã€‚ä¿å­˜æŸ¥è¯¢ä»¥ä¾¿å¿«é€Ÿè®¿é—®ã€‚è®¢é˜…æŸ¥è¯¢ä»¥è·å–æœ‰è¶£äº‹ä»¶çš„é€šçŸ¥ã€‚

ğŸ›ï¸ å›¢é˜Ÿå’Œç”¨æˆ·çš„ä»ªè¡¨æ¿

åœ¨è‡ªå®šä¹‰ä»ªè¡¨æ¿ä¸­æ’åˆ—å°å·¥å…·ï¼Œä»¥ä¾¿ä¸€ç›®äº†ç„¶åœ°è·å–é‡è¦ä¿¡æ¯ã€‚ä¸ç”¨æˆ·æˆ–ç»„å…±äº«ä»ªè¡¨æ¿ï¼Œæˆ–å°†å…¶å…¬å¼€ç»™æ‰€æœ‰äººã€‚

ğŸ‘¯ è½»æ¾çš„é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§

è½»æ¾çš„é›†ç¾¤è®¾ç½®ã€‚è·¨ä¸åŒæœåŠ¡å™¨å¤åˆ¶é¡¹ç›®ä»¥å®ç°é«˜å¯ç”¨æ€§ï¼Œæˆ–åˆ†å‘é¡¹ç›®ä»¥å®ç°æ°´å¹³å¯æ‰©å±•æ€§ã€‚

ğŸ›¸ ç”¨äºå¿«é€Ÿè®¿é—®çš„å‘½ä»¤é¢æ¿

ä½¿ç”¨ cmd/ctrl-k ä»ä»»ä½•åœ°æ–¹è°ƒå‡ºå‘½ä»¤é¢æ¿ã€‚æœç´¢ä»»ä½•å†…å®¹å¹¶è·³è½¬åˆ°å®ƒï¼Œè€Œæ— éœ€ç¿»é˜…èœå•ã€‚

ğŸ“ˆ å„è¯­è¨€çš„ SLOC è¶‹åŠ¿

æ£€æŸ¥ä¸»åˆ†æ”¯çš„ git å†å²è®°å½•ï¼Œä»¥æœ‰æ•ˆè®¡ç®—æŒ‰è¯­è¨€åˆ’åˆ†çš„æºä»£ç è¡Œè¶‹åŠ¿

ğŸ•Šï¸ å¿«é€Ÿã€è½»ä¾¿ã€å¯é 

ç²¾å¿ƒè®¾è®¡æ—¶è€ƒè™‘äº†èµ„æºä½¿ç”¨å’Œæ€§èƒ½ã€‚é€šè¿‡é€‚ç”¨äºä¸­å‹é¡¹ç›®çš„ 1 æ ¸ 2G å†…å­˜ç›’è·å¾—ä¸Šè¿°æ‰€æœ‰åŠŸèƒ½ã€‚å¯†é›†ä½¿ç”¨è¶…è¿‡5å¹´ï¼Œå¯é æ€§ç»è¿‡å®æˆ˜éªŒè¯ã€‚

## å®‰è£…è¯´æ˜

### æ— äººå€¼å®ˆ

é€šè¿‡å¡«å†™å¿…é¡»çš„ç¯å¢ƒå˜é‡æ¥é…ç½® OneDevï¼Œæ— éœ€é€šè¿‡ Web ç•Œé¢è¿›è¡Œé…ç½®ã€‚

+ `ç®¡ç†å‘˜å¸æˆ·` - ç®¡ç†å‘˜å¸æˆ·çš„ç”¨æˆ·å
+ `ç®¡ç†å‘˜å¯†ç ` - ç®¡ç†å‘˜å¸æˆ·çš„å¯†ç 
+ `ç®¡ç†å‘˜ç”µå­é‚®ä»¶` - ç®¡ç†å‘˜å¸æˆ·çš„ç”µå­é‚®ä»¶åœ°å€
+ `æœåŠ¡ç«¯åœ°å€` - OneDev æœåŠ¡ç«¯çš„åœ°å€ (ä¾‹å¦‚ `https://onedev.io`)
+ `SSH æœåŠ¡ç«¯åœ°å€` - (å¯é€‰) ç”¨äº SSH å…‹éš†çš„åœ°å€ (ä¾‹å¦‚ `ssh://onedev.io`)

ä¸å¡«å†™ `SSH æœåŠ¡ç«¯åœ°å€` æ—¶ï¼Œå°†ä» `æœåŠ¡ç«¯åœ°å€` æ´¾ç”Ÿã€‚

### ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“

OneDev é»˜è®¤ä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å­˜å‚¨æ•°æ®ã€‚ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“éœ€è¦å‰å¾€åº”ç”¨å®‰è£…ç›®å½•ä¸‹çš„ `config` ç›®å½•ï¼Œç¼–è¾‘ `onedev.env` æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚

å¡«å†™ `onedev.env` æ—¶ï¼Œè¯·åˆ é™¤å¯¹åº” `#` å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚æ•°æ®åº“åªèƒ½é€‰æ‹©ä¸€ç§ï¼Œå¡«å†™å¤šä¸ªæ•°æ®åº“é…ç½®ä¿¡æ¯å°†å¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚

å¤–éƒ¨æ•°æ®åº“ç±»å‹ï¼Œæ”¯æŒ `MySQL`ã€`PostgreSQL`ã€`MariaDB`ã€`MS SQL Server`

> æ•°æ®åº“é…ç½®ä¿¡æ¯
>
> `hibernate_dialect` - æ•°æ®åº“æ–¹è¨€ (å›ºå®šå€¼)
>
> `hibernate_connection_driver_class` - æ•°æ®åº“é©±åŠ¨ (å›ºå®šå€¼)
>
> `hibernate_connection_url` - æ•°æ®åº“è¿æ¥åœ°å€ (è¯·æ ¹æ®æ•°æ®åº“ç±»å‹å¡«å†™)
>
> `hibernate_connection_username` - æ•°æ®åº“ç”¨æˆ·å (è¯·æ ¹æ®æ•°æ®åº“ç±»å‹å¡«å†™)
>
> `hibernate_connection_password` - æ•°æ®åº“å¯†ç  (è¯·æ ¹æ®æ•°æ®åº“ç±»å‹å¡«å†™)

| Database      | Hibernate Dialect                              | Driver Class                                 | Connection URL                                                                                                            | Username | Password | Notes                   |
|---------------|------------------------------------------------|----------------------------------------------|---------------------------------------------------------------------------------------------------------------------------|----------|----------|-------------------------|
| MySQL         | org.hibernate.dialect.MySQL5InnoDBDialect      | com.mysql.cj.jdbc.Driver                     | jdbc:mysql://localhost:3306/onedev?serverTimezone=UTC&allowPublicKeyRetrieval=true&useSSL=false&disableMariaDbDriver=true | root     | root     |                         |
| PostgreSQL    | io.onedev.server.persistence.PostgreSQLDialect | org.postgresql.Driver                        | jdbc:postgresql://localhost:5432/onedev                                                                                   | postgres | postgres | è¯·ç¡®ä¿åœ¨æ­¤å¤„ä½¿ç”¨ OneDev è‡ªå·±ç‰ˆæœ¬çš„æ–¹è¨€ |
| MariaDB       | org.hibernate.dialect.MySQL5InnoDBDialect      | org.mariadb.jdbc.Driver                      | jdbc:mariadb://localhost:3306/onedev                                                                                      | root     | root     |                         |
| MS SQL Server | org.hibernate.dialect.SQLServer2012Dialect     | com.microsoft.sqlserver.jdbc.SQLServerDriver | jdbc:sqlserver://localhost:1433;databaseName=onedev                                                                       | sa       | sa       |                         |

#### ç¤ºä¾‹

> MySQL

```env
hibernate_dialect=org.hibernate.dialect.MySQL5InnoDBDialect
hibernate_connection_driver_class=com.mysql.cj.jdbc.Driver
hibernate_connection_url=jdbc:mysql://localhost:3306/onedev?serverTimezone=UTC&allowPublicKeyRetrieval=true&useSSL=false&disableMariaDbDriver=true
hibernate_connection_username=root
hibernate_connection_password=root
```

> PostgreSQL

```env
hibernate_dialect=io.onedev.server.persistence.PostgreSQLDialect
hibernate_connection_driver_class=org.postgresql.Driver
hibernate_connection_url=jdbc:postgresql://localhost:5432/onedev
hibernate_connection_username=postgres
hibernate_connection_password=postgres
```

> MariaDB

```env
hibernate_dialect=org.hibernate.dialect.MySQL5InnoDBDialect
hibernate_connection_driver_class=org.mariadb.jdbc.Driver
hibernate_connection_url=jdbc:mariadb://localhost:3306/onedev
hibernate_connection_username=root
hibernate_connection_password=root
```

> MS SQL Server

```env
hibernate_dialect=org.hibernate.dialect.SQLServer2012Dialect
hibernate_connection_driver_class=com.microsoft.sqlserver.jdbc.SQLServerDriver
hibernate_connection_url=jdbc:sqlserver://localhost:1433;databaseName=onedev
hibernate_connection_username=sa
hibernate_connection_password=sa
```

## åå‘ä»£ç†

å‡è®¾æ‚¨çš„ OneDev å®ä¾‹åœ¨ç«¯å£ 6610 ä¸Šè¿è¡Œï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›é€šè¿‡ http://onedev.example.com è®¿é—®å®ƒã€‚

è¯·æ³¨æ„ä¸è¦ä½¿ç”¨ `localhost` ä½œä¸º `proxy_pass` çš„ç›®æ ‡ï¼ŒDocker å®¹å™¨å†…çš„ `localhost` æ˜¯å®¹å™¨æœ¬èº«ï¼Œè€Œä¸æ˜¯å®¿ä¸»æœºã€‚

### Nginx

```nginx
server {
    listen 80;
    listen [::]:80;

    server_name onedev.example.com;

    # ä¸Šä¼ æ–‡ä»¶å¤§å°ä¸é™åˆ¶
    client_max_body_size 0;

    location /wicket/websocket {
            proxy_pass http://localhost:6610/wicket/websocket;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
    }

    location /~server {
            proxy_pass http://localhost:6610/~server;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
    }

    location /~api/streaming {
            proxy_pass http://localhost:6610/~api/streaming;
            proxy_buffering off;
    }

    location / {
            proxy_pass http://localhost:6610/;
    }
}
```

### Caddy Server

```caddy
    caddy reverse-proxy --from onedev.example.com --to localhost:6610
```

---

![Ms Studio](https://file.lifebus.top/imgs/ms_blank_001.png)
